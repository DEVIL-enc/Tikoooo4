<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>RESIST TIK</title>
<style>
body{margin:0;background:#081a2b;color:#fff;font-family:system-ui}
.box{max-width:600px;margin:40px auto;background:#0b2a44;padding:20px;border-radius:20px}
.plans{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.plan{padding:12px 16px;border-radius:14px;border:none;background:#123e63;color:#fff;font-weight:bold;cursor:pointer}
.plan.active{outline:2px solid #00d4ff}
#desc{margin-top:10px;font-size:13px;opacity:.85;text-align:center;line-height:1.6}
button.start{width:100%;margin-top:15px;padding:14px;border-radius:14px;border:none;background:#00d4ff;color:#001;font-weight:900;cursor:pointer}
#msg{margin-top:10px;text-align:center;font-size:13px}
</style>
</head>
<body>
<div class="box">
<h2 style="text-align:center;margin-top:0">Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙŠØ¯ÙŠÙˆ ØªÙŠÙƒ ØªÙˆÙƒ</h2>

<div class="plans">
  <button id="btnFast" class="plan" onclick="setP('fast')">Ø³Ø±ÙŠØ¹ âš¡</button>
  <button id="btnSmooth" class="plan" onclick="setP('smooth')">Ù…Ø­Ø³Ù‘Ù† âœ¨</button>
  <button id="btnUltra" class="plan" onclick="setP('ultra')">Ø§Ø­ØªØ±Ø§ÙÙŠ ğŸ”¥</button>
</div>

<p id="desc"></p>

<input type="file" id="file" accept="video/*" style="width:100%;padding:12px;margin-top:15px;border-radius:12px">

<button class="start" onclick="send()">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button>
<p id="msg"></p>
</div>

<script>
let plan="fast";
const descEl=document.getElementById("desc");

function setP(p){
  plan=p;
  document.getElementById("btnFast").classList.remove("active");
  document.getElementById("btnSmooth").classList.remove("active");
  document.getElementById("btnUltra").classList.remove("active");

  if(p==="fast"){
    document.getElementById("btnFast").classList.add("active");
    descEl.textContent="Ø³Ø±ÙŠØ¹ âš¡: Ø£Ù‚Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ£Ø³Ø±Ø¹ ÙˆÙ‚Øª â€” Ù…Ù†Ø§Ø³Ø¨ Ø¥Ø°Ø§ ØªØ¨ÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ·Ù„Ø¹ Ø¨Ø³Ø±Ø¹Ø©.";
  }
  if(p==="smooth"){
    document.getElementById("btnSmooth").classList.add("active");
    descEl.textContent="Ù…Ø­Ø³Ù‘Ù† âœ¨: Ø³Ù„Ø§Ø³Ø© Ø£ÙˆØ¶Ø­ ÙˆØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ· Ù„Ù„Ø¬ÙˆØ¯Ø© â€” Ø®ÙŠØ§Ø± Ù…Ù…ØªØ§Ø² Ù„ØªÙŠÙƒ ØªÙˆÙƒ.";
  }
  if(p==="ultra"){
    document.getElementById("btnUltra").classList.add("active");
    descEl.textContent="Ø§Ø­ØªØ±Ø§ÙÙŠ ğŸ”¥: Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø© Ù…Ù…ÙƒÙ†Ø© (ØªÙ†Ø¹ÙŠÙ… + ÙˆØ¶ÙˆØ­ + Ø³Ù„Ø§Ø³Ø© Ù‚ÙˆÙŠØ©) â€” ÙŠØ£Ø®Ø° ÙˆÙ‚Øª Ø£Ø·ÙˆÙ„.";
  }
}
setP("fast");

async function send(){
  const msg=document.getElementById("msg");
  const file=document.getElementById("file").files[0];
  const key=localStorage.getItem("KEY");
  const device=localStorage.getItem("DEVICE");

  if(!file){msg.textContent="Ø§Ø®ØªØ§Ø± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹";return;}
  if(!key||!device){msg.textContent="Ù„Ø§Ø²Ù… ØªØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„";location.href="/login.html";return;}

  msg.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";

  const fd=new FormData();
  fd.append("file",file);
  fd.append("plan",plan);

  const r=await fetch("/process",{method:"POST",headers:{"X-KEY":key,"X-DEVICE":device},body:fd});

  if(!r.ok){
    let next="";
    try{const e=await r.json(); if(e.next_plan) next=" â€” Ø¬Ø±Ù‘Ø¨: "+e.next_plan;}catch(_){}
    msg.textContent="ÙØ´Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©"+next;
    return;
  }

  const b=await r.blob();
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="output.mp4";
  a.click();
  msg.textContent="ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© âœ…";
}
</script>
</body>
</html>
